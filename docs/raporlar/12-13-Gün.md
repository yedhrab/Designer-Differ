# 12. ve 13. GÃ¼n NotlarÄ±

## VSIX Aktif DÃ¶kÃ¼manÄ±n Ä°Ã§eriÄŸini Alma

```c#
protected DTE2 dte;
dte2 = (EnvDTE80.DTE2)GetService(typeof(EnvDTE.DTE));

public string GetCurrentTextFile(){

  TextDocument doc = (TextDocument)(dte.ActiveDocument.Object("TextDocument"));
  var p = doc.StartPoint.CreateEditPoint();
  string s = p.GetText(doc.EndPoint);

  return s;            
}
```

> [In VisualStudio DTE, how to get the contents of the ActiveDocument?](https://stackoverflow.com/questions/10606274/in-visualstudio-dte-how-to-get-the-contents-of-the-activedocument)


## VSIX DTE Otomasyon Modeli

![](assets/vsix_dte_automation_model.png)

> [Automation model overview](https://docs.microsoft.com/en-us/visualstudio/extensibility/internals/automation-model-overview?view=vs-2019)

## VSIX Dosyadan FileCodeModel OluÅŸturma

- ğŸ’¡ Ã–ncelikle stack overflow Ã¼zerindeki cevabÄ±m [buradadÄ±r](https://stackoverflow.com/a/63694279/9770490)
- ğŸ‘®â€â™‚ï¸ Visual Studio iÃ§erisinde aÃ§Ä±lan proje dosyalarÄ±nÄ±n `FileCodeModel` objesine eriÅŸilebilir
- ğŸ—ƒï¸ `dte.ItemOperations.OpenFile` ile aÃ§Ä±lan dosyalar, `Miscellaneous` olarak gÃ¶zÃ¼kÃ¼r, `ProjectItem` deÄŸildir
- ğŸ“‚ DosyayÄ± `ProjectItem` olarak aÃ§mak iÃ§in `dte.ItemOperations.AddExistingItem(filePath);` kodu kullanÄ±lÄ±r
- ğŸ‘¨â€ğŸ’» Eklenen dosyanÄ±n `FileCodeModel` iÃ§eriÄŸine `projectItem.FileCodeModel` ÅŸeklinde eriÅŸiriz
- Ä°steÄŸe baÄŸlÄ± olarak` ProjectItem.Delete()` ile eklenen dosya kaldÄ±rÄ±labilir

```c#
using EnvDTE;

public static async Task<DTE2> GetDTE2Async(IAsyncServiceProvider asyncServiceProvider) => await asyncServiceProvider.GetServiceAsync(typeof(DTE)).ConfigureAwait(false) as DTE2 ?? throw new NullReferenceException("DTE alÄ±namadÄ±");

string filepath = "TODO";
DTE2 dte2 = await Utility.GetDTE2Async(asyncServiceProvider);
ProjectItem projectItem = dte2.ItemOperations.AddExistingItem(filepath);
FileCodeModel fcm = projectItem.FileCodeModel;
projectItem.Delete();
```

> - [How do I programmatically add a file to a Solution?](https://stackoverflow.com/a/11934026/9770490s)
> - [FileCodeModel null for file in "Misc Files" project. ~ Windows Tech](http://www.windows-tech.info/4/004ffb867c3564c0.php)
> - [FileCodeModel null for file in "Misc Files" project. ~ Microsoft](https://social.msdn.microsoft.com/Forums/sqlserver/en-US/925a2ba3-728b-4bfd-8802-091ef258eace/filecodemodel-null-for-file-in-misc-files-project?forum=vsx)
